
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Frequency Response: Hearing Test: Lab P-11</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-04-15"><meta name="DC.source" content="HearingTest.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Frequency Response: Hearing Test: Lab P-11</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">4. Conduct a test of your hearing.</a></li></ul></div><h2 id="1">4. Conduct a test of your hearing.</h2><p>This test will be performed measuring hearing thresholds using Bekesy audiometry which takes into account the bias in terms of the amplitude trajectory of the tone presented. First, the tone will start out sub-threshold and its amplitude will gradually increase until it is audible, then its amplitude will gradually decrease until it is unaudible. The threshold will be the midpoint of all the audible amplitudes for each frequency.</p><pre class="codeinput"><span class="comment">% A graphical user interface is created so the user himself/herself can condut his/her test. He/She has to initialize the test clicking the 'Start' button, then clicking 'Yes' or 'No' depending if he/she hears or not the</span>
<span class="comment">% tone. After completing the whole range of frequency (250Hz-8000Hz), the user clicks on 'Plot' to get a graphical representation of his/her hearing threshold.</span>

<span class="comment">% This part of the code contains the initialization of the app, which can not be modified, and commands that execute just before the graphical interface is visible to the user.</span>

<span class="keyword">function</span> varargout = HearingTest(varargin)
<span class="comment">% HEARINGTEST MATLAB code for HearingTest.fig</span>
<span class="comment">%      HEARINGTEST, by itself, creates a new HEARINGTEST or raises the existing</span>
<span class="comment">%      singleton*.</span>
<span class="comment">%</span>
<span class="comment">%      H = HEARINGTEST returns the handle to a new HEARINGTEST or the handle to</span>
<span class="comment">%      the existing singleton*.</span>
<span class="comment">%</span>
<span class="comment">%      HEARINGTEST('CALLBACK',hObject,eventData,handles,...) calls the local</span>
<span class="comment">%      function named CALLBACK in HEARINGTEST.M with the given input arguments.</span>
<span class="comment">%</span>
<span class="comment">%      HEARINGTEST('Property','Value',...) creates a new HEARINGTEST or raises the</span>
<span class="comment">%      existing singleton*.  Starting from the left, property value pairs are</span>
<span class="comment">%      applied to the GUI before HearingTest_OpeningFcn gets called.  An</span>
<span class="comment">%      unrecognized property name or invalid value makes property application</span>
<span class="comment">%      stop.  All inputs are passed to HearingTest_OpeningFcn via varargin.</span>
<span class="comment">%</span>
<span class="comment">%      *See GUI Options on GUIDE's Tools menu.  Choose "GUI allows only one</span>
<span class="comment">%      instance to run (singleton)".</span>


<span class="comment">% Begin initialization code - DO NOT EDIT</span>
gui_Singleton = 1;
gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
                   <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
                   <span class="string">'gui_OpeningFcn'</span>, @HearingTest_OpeningFcn, <span class="keyword">...</span>
                   <span class="string">'gui_OutputFcn'</span>,  @HearingTest_OutputFcn, <span class="keyword">...</span>
                   <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
                   <span class="string">'gui_Callback'</span>,   []);
<span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
<span class="keyword">end</span>

<span class="keyword">if</span> nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
<span class="keyword">else</span>
    gui_mainfcn(gui_State, varargin{:});
<span class="keyword">end</span>
<span class="comment">% End initialization code - DO NOT EDIT</span>


<span class="comment">% --- Executes just before HearingTest is made visible.</span>
<span class="keyword">function</span> HearingTest_OpeningFcn(hObject, eventdata, handles, varargin)
<span class="comment">% hObject    handle to figure</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
<span class="comment">% varargin   command line arguments to HearingTest (see VARARGIN)</span>

<span class="comment">% Choose default command line output for HearingTest</span>
handles.output = hObject;
handles.s=0; <span class="comment">% Variable 's' stores the response of the user to the question whether the tone was heard or not.</span>
handles.t=[]; <span class="comment">% It stores hearing threshold points.</span>


<span class="comment">% Update handles structure</span>
guidata(hObject, handles);

<span class="comment">% --- Outputs from this function are returned to the command line.</span>
<span class="keyword">function</span> varargout = HearingTest_OutputFcn(hObject, eventdata, handles)
<span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
<span class="comment">% hObject    handle to figure</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Get default command line output from handles structure</span>
varargout{1} = handles.output;

<span class="comment">%This part of the code, contains the commands to execute when the buttons are pressed (Callbacks).</span>

<span class="comment">% --- Executes on button press in Plot.</span>
<span class="keyword">function</span> Plot_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Plot (see GCBO)</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
handles = guidata(hObject);
frequencies=[250 500 1000 2000 4000 8000]; <span class="comment">%Selected frequencies to test.</span>
plot(handles.axes1,frequencies,handles.t,<span class="string">'bo-'</span>) <span class="comment">%Plotting Hearing Threshold graph.</span>
xlabel(<span class="string">'Frequency'</span>)
ylabel(<span class="string">'dB'</span>)
title(<span class="string">'Hearing Threshold'</span>)

<span class="comment">% --- Executes on button press in Yes.</span>
<span class="keyword">function</span> Yes_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Yes (see GCBO)</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
handles.s=1; <span class="comment">% When botton Yes is pressed, the status of variable 's' is 1.</span>
guidata(hObject, handles);
uiresume <span class="comment">% Resumes the program execution.</span>

<span class="comment">% --- Executes on button press in Start.</span>
<span class="keyword">function</span> Start_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to Start (see GCBO)</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
set(handles.text4,<span class="string">'String'</span>,<span class="string">'In process'</span>); <span class="comment">%Changes the status of the test to 'In Process'.</span>
frequencies=[250 500 1000 2000 4000 8000]; <span class="comment">% Selected frequencies to test.</span>
i=1; <span class="comment">% This variable is used to move between rows of the matrix containing the audible tones.</span>
tt=0:1/20000:1; <span class="comment">% Sampling rate = 20kHz ; Duration = 1 second.</span>
<span class="keyword">for</span> y=frequencies
    <span class="comment">% Initial decibles values for each frequency.</span>
    <span class="keyword">if</span> y==250
        dB=-30;
    <span class="keyword">elseif</span> y==500
        dB=-40;
    <span class="keyword">elseif</span> y==1000
        dB=-40;
    <span class="keyword">elseif</span> y==2000
        dB=-50;
    <span class="keyword">elseif</span> y==4000
        dB=-55;
    <span class="keyword">elseif</span> y==8000;
        dB=-30;
    <span class="keyword">end</span>
    m=1; <span class="comment">% This variable is used to move between columns of the matrix containing the audible tones.</span>

<span class="comment">% In this loop, the tone start sub-threshold and the amplitude increases everytime the user presses 'No' button.</span>

    <span class="keyword">while</span> 1
        xx=(10^(dB/20))*cos(2*pi*y*tt+rand(1)*2*pi);
        sound(xx,20000) <span class="comment">% Produces the tone.</span>
        pause(1)
        uiwait <span class="comment">% Wait for user response</span>
        handles = guidata(hObject);
        <span class="keyword">if</span> handles.s==1
            range(i,m)=dB; <span class="comment">% Store the amplitude of the audible tone.</span>
            m=m+1;
            <span class="keyword">break</span> <span class="comment">% If the user hears the tone the loop is broken.</span>
        <span class="keyword">end</span>
        dB=dB+1; <span class="comment">% Increase amplitude.</span>
    <span class="keyword">end</span>

<span class="comment">% In this loop, the tone will decrease everytime the user presses 'Yes' button.</span>

    <span class="keyword">while</span> 1
        xx=(10^(dB/20))*cos(2*pi*y*tt+rand(1)*2*pi);
        sound(xx,20000) <span class="comment">% Produces the tone.</span>
        pause(1)
        uiwait <span class="comment">% Wait for user response</span>
        handles = guidata(hObject);
        <span class="keyword">if</span> handles.s==0
            <span class="keyword">break</span> <span class="comment">% If the user does not hear the tone, the loop is broken.</span>
        <span class="keyword">end</span>
        range(i,m)=dB; <span class="comment">% Store the amplitude of the audible tone.</span>
        m=m+1;
        dB=dB-1; <span class="comment">% Decrease amplitude.</span>
    <span class="keyword">end</span>
    i=i+1;
<span class="keyword">end</span>

<span class="comment">% The threshold is calculated for every frequency.</span>

Threshold=[((max(range(1,:))+min(range(1,:)))/2) ((max(range(2,:))+min(range(2,:)))/2) ((max(range(3,:))+min(range(3,:)))/2) ((max(range(4,:))+min(range(4,:)))/2) ((max(range(5,:))+min(range(5,:)))/2) ((max(range(6,:))+min(range(6,:)))/2)];
handles.t=Threshold;
guidata(hObject, handles);
set(handles.text4,<span class="string">'String'</span>,<span class="string">'Finished'</span>); <span class="comment">%Changes the status of the test to 'Finished'.</span>

<span class="comment">% --- Executes on button press in No.</span>
<span class="keyword">function</span> No_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to No (see GCBO)</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
handles.s=0; <span class="comment">% When botton No is pressed, the status of variable 's' is 0.</span>
guidata(hObject, handles);
uiresume <span class="comment">% Resumes the program execution.</span>
</pre><img vspace="5" hspace="5" src="HearingTest_01.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Frequency Response: Hearing Test: Lab P-11

%% 4. Conduct a test of your hearing.
% This test will be performed measuring hearing thresholds using Bekesy audiometry which takes into account the bias in terms of the amplitude trajectory of the tone presented. First, the tone will start out sub-threshold 
% and its amplitude will gradually increase until it is audible, then its amplitude will gradually decrease until it is unaudible. The threshold will be the midpoint of all the audible amplitudes for each frequency.

% A graphical user interface is created so the user himself/herself can condut his/her test. He/She has to initialize the test clicking the 'Start' button, then clicking 'Yes' or 'No' depending if he/she hears or not the 
% tone. After completing the whole range of frequency (250Hz-8000Hz), the user clicks on 'Plot' to get a graphical representation of his/her hearing threshold.

% This part of the code contains the initialization of the app, which can not be modified, and commands that execute just before the graphical interface is visible to the user. 
 
function varargout = HearingTest(varargin)
% HEARINGTEST MATLAB code for HearingTest.fig
%      HEARINGTEST, by itself, creates a new HEARINGTEST or raises the existing
%      singleton*.
%
%      H = HEARINGTEST returns the handle to a new HEARINGTEST or the handle to
%      the existing singleton*.
%
%      HEARINGTEST('CALLBACK',hObject,eventData,handles,...) calls the local
%      function named CALLBACK in HEARINGTEST.M with the given input arguments.
%
%      HEARINGTEST('Property','Value',...) creates a new HEARINGTEST or raises the
%      existing singleton*.  Starting from the left, property value pairs are
%      applied to the GUI before HearingTest_OpeningFcn gets called.  An
%      unrecognized property name or invalid value makes property application
%      stop.  All inputs are passed to HearingTest_OpeningFcn via varargin.
%
%      *See GUI Options on GUIDE's Tools menu.  Choose "GUI allows only one
%      instance to run (singleton)".


% Begin initialization code - DO NOT EDIT
gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
                   'gui_Singleton',  gui_Singleton, ...
                   'gui_OpeningFcn', @HearingTest_OpeningFcn, ...
                   'gui_OutputFcn',  @HearingTest_OutputFcn, ...
                   'gui_LayoutFcn',  [] , ...
                   'gui_Callback',   []);
if nargin && ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    gui_mainfcn(gui_State, varargin{:});
end
% End initialization code - DO NOT EDIT


% REPLACE_WITH_DASH_DASH- Executes just before HearingTest is made visible.
function HearingTest_OpeningFcn(hObject, eventdata, handles, varargin)
% hObject    handle to figure
% handles    structure with handles and user data (see GUIDATA)
% varargin   command line arguments to HearingTest (see VARARGIN)

% Choose default command line output for HearingTest
handles.output = hObject;
handles.s=0; % Variable 's' stores the response of the user to the question whether the tone was heard or not.
handles.t=[]; % It stores hearing threshold points. 


% Update handles structure
guidata(hObject, handles);

% REPLACE_WITH_DASH_DASH- Outputs from this function are returned to the command line.
function varargout = HearingTest_OutputFcn(hObject, eventdata, handles) 
% varargout  cell array for returning output args (see VARARGOUT);
% hObject    handle to figure
% handles    structure with handles and user data (see GUIDATA)

% Get default command line output from handles structure
varargout{1} = handles.output;

%This part of the code, contains the commands to execute when the buttons are pressed (Callbacks). 

% REPLACE_WITH_DASH_DASH- Executes on button press in Plot.
function Plot_Callback(hObject, eventdata, handles)
% hObject    handle to Plot (see GCBO)
% handles    structure with handles and user data (see GUIDATA)
handles = guidata(hObject);
frequencies=[250 500 1000 2000 4000 8000]; %Selected frequencies to test.
plot(handles.axes1,frequencies,handles.t,'bo-') %Plotting Hearing Threshold graph.
xlabel('Frequency')
ylabel('dB')
title('Hearing Threshold')

% REPLACE_WITH_DASH_DASH- Executes on button press in Yes.
function Yes_Callback(hObject, eventdata, handles)
% hObject    handle to Yes (see GCBO)
% handles    structure with handles and user data (see GUIDATA)
handles.s=1; % When botton Yes is pressed, the status of variable 's' is 1.
guidata(hObject, handles);
uiresume % Resumes the program execution.

% REPLACE_WITH_DASH_DASH- Executes on button press in Start.
function Start_Callback(hObject, eventdata, handles)
% hObject    handle to Start (see GCBO)
% handles    structure with handles and user data (see GUIDATA)
set(handles.text4,'String','In process'); %Changes the status of the test to 'In Process'.
frequencies=[250 500 1000 2000 4000 8000]; % Selected frequencies to test.
i=1; % This variable is used to move between rows of the matrix containing the audible tones. 
tt=0:1/20000:1; % Sampling rate = 20kHz ; Duration = 1 second.
for y=frequencies 
    % Initial decibles values for each frequency.
    if y==250
        dB=-30;
    elseif y==500
        dB=-40;
    elseif y==1000
        dB=-40;
    elseif y==2000
        dB=-50;
    elseif y==4000
        dB=-55;
    elseif y==8000;
        dB=-30;
    end
    m=1; % This variable is used to move between columns of the matrix containing the audible tones.
    
% In this loop, the tone start sub-threshold and the amplitude increases everytime the user presses 'No' button.

    while 1 
        xx=(10^(dB/20))*cos(2*pi*y*tt+rand(1)*2*pi);
        sound(xx,20000) % Produces the tone.
        pause(1) 
        uiwait % Wait for user response
        handles = guidata(hObject);
        if handles.s==1 
            range(i,m)=dB; % Store the amplitude of the audible tone.
            m=m+1;
            break % If the user hears the tone the loop is broken.
        end
        dB=dB+1; % Increase amplitude.
    end
    
% In this loop, the tone will decrease everytime the user presses 'Yes' button. 

    while 1
        xx=(10^(dB/20))*cos(2*pi*y*tt+rand(1)*2*pi);
        sound(xx,20000) % Produces the tone.
        pause(1)
        uiwait % Wait for user response
        handles = guidata(hObject);
        if handles.s==0 
            break % If the user does not hear the tone, the loop is broken.
        end
        range(i,m)=dB; % Store the amplitude of the audible tone.
        m=m+1;
        dB=dB-1; % Decrease amplitude.
    end
    i=i+1;
end

% The threshold is calculated for every frequency.

Threshold=[((max(range(1,:))+min(range(1,:)))/2) ((max(range(2,:))+min(range(2,:)))/2) ((max(range(3,:))+min(range(3,:)))/2) ((max(range(4,:))+min(range(4,:)))/2) ((max(range(5,:))+min(range(5,:)))/2) ((max(range(6,:))+min(range(6,:)))/2)];
handles.t=Threshold;
guidata(hObject, handles);
set(handles.text4,'String','Finished'); %Changes the status of the test to 'Finished'.
    
% REPLACE_WITH_DASH_DASH- Executes on button press in No.
function No_Callback(hObject, eventdata, handles)
% hObject    handle to No (see GCBO)
% handles    structure with handles and user data (see GUIDATA)
handles.s=0; % When botton No is pressed, the status of variable 's' is 0.
guidata(hObject, handles);
uiresume % Resumes the program execution.

##### SOURCE END #####
--></body></html>